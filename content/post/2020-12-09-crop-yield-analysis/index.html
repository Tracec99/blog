---
title: Crop Yield Analysis
author: Trace Freeman
date: '2020-12-09'
slug: crop-yield-analysis
categories: []
tags: []
editor_options: 
  chunk_output_type: console
---

<link href="index_files/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="index_files/anchor-sections/anchor-sections.js"></script>


<pre class="r"><code>library(tidyverse)
library(here)
library(patchwork)</code></pre>
<p>I will be analyzing global agricultural development using data taken from the TidyTuesday GitHub page. The primary data I will be using is contained <code>key_crop_yields.csv</code>, which has 13,075 observations and 14 variables: The variable <code>Entity</code>, a character that denotes the name of the region or country the observation comes from, the variable <code>Code</code>, which is the country code of the country the observation comes from (continents and regions use NA, and <code>Year</code>, a double ranging from 1961-2014 that represents the year the observation comes from. Additionally, there are 11 other variables representing 11 different crops and their yield in metric tonnes per hectare. The different crops represented are wheat, rice, maize, soybeans, potatoes, beans, peas, cassava, barley, cocoa beans, and bananas.</p>
<p>The other data of interest are found in <code>arable_land_pin.csv</code>, which contains the additional double variable <code>Arable land needed to produce a fixed quantity of crops ((1.0 = 1961))</code>, which can be used to track changes in land use efficiency over time. I will also be using the data in the files <code>cereal_crop_yield_vs_fertilizer_application.csv</code> and <code>cereal_yields_vs_tractor_inputs_in_agriculture.csv</code>, both of which track the use of fertilizer and tractors in agriculture over time, two important factors in farming efficiency. <code>Fertilizer</code> contains the additional variables <code>Cereal yield</code> and <code>Nitrogen fertilizer use</code>, while <code>Tractor_inputs</code> contains <code>Tractors per 100 sq km arable land</code>, <code>Cereal yield (kilograms per hectare)</code>, and <code>Total population</code>, which is taken from the Gapminder dataset. Each of these 3 datasets also contain the key variables <code>Entity</code>, <code>Code</code>, and <code>Year</code>.</p>
<pre class="r"><code>filepath &lt;- here(&#39;data&#39;, &#39;tidytuesday&#39;, &#39;data&#39;, &#39;2020&#39;, &#39;2020-09-01&#39;)
files &lt;- dir(filepath)
csv_vec &lt;- str_detect(files, &#39;(.csv$)&#39;) # read only .csv files
dat &lt;- list()

for (i in 1:length(files)) {
  if (csv_vec[i] &amp; files[i] != &quot;land_use_vs_yield_change_in_cereal_production.csv&quot;) {
    dat[[i]] &lt;- read_csv(paste(filepath, files[i], sep=&#39;/&#39;))
  }
}</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   Entity = col_character(),
##   Code = col_character(),
##   Year = col_double(),
##   `Arable land needed to produce a fixed quantity of crops ((1.0 = 1961))` = col_double()
## )</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   Entity = col_character(),
##   Code = col_character(),
##   Year = col_double(),
##   `Cereal yield (tonnes per hectare)` = col_double(),
##   `Nitrogen fertilizer use (kilograms per hectare)` = col_double()
## )</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   Entity = col_character(),
##   Code = col_character(),
##   Year = col_character(),
##   `Tractors per 100 sq km arable land` = col_double(),
##   `Cereal yield (kilograms per hectare) (kg per hectare)` = col_double(),
##   `Total population (Gapminder)` = col_double()
## )</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   Entity = col_character(),
##   Code = col_character(),
##   Year = col_double(),
##   `Wheat (tonnes per hectare)` = col_double(),
##   `Rice (tonnes per hectare)` = col_double(),
##   `Maize (tonnes per hectare)` = col_double(),
##   `Soybeans (tonnes per hectare)` = col_double(),
##   `Potatoes (tonnes per hectare)` = col_double(),
##   `Beans (tonnes per hectare)` = col_double(),
##   `Peas (tonnes per hectare)` = col_double(),
##   `Cassava (tonnes per hectare)` = col_double(),
##   `Barley (tonnes per hectare)` = col_double(),
##   `Cocoa beans (tonnes per hectare)` = col_double(),
##   `Bananas (tonnes per hectare)` = col_double()
## )</code></pre>
<p>dat[[4]]: key_crop_yields.csv</p>
<pre class="r"><code>crop_yields_long &lt;- dat[[4]] %&gt;%
  pivot_longer(., -c(&#39;Entity&#39;, &#39;Code&#39;, &#39;Year&#39;), names_to = &#39;Crop&#39;, values_to = &#39;Value&#39;)
  
total_crops_by_year &lt;- crop_yields_long %&gt;%
  group_by(Year, Crop) %&gt;%
  summarize(Crop_Total = sum(Value, na.rm = TRUE))

  ggplot(total_crops_by_year, aes(x = Year, y = Crop_Total, color = Crop)) +
  geom_line()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="672" />
Looking at the above plot, it seems that the two most abundant crops in tonnes per hectare are bananas and potatoes. Bananas began as the most abundant in 1961, but were surpassed by potatoes sometime in the mid 70’s. How do the distribution of yields of these two crops compare?</p>
<pre class="r"><code>avg_yield_potatoes20 &lt;- crop_yields_long %&gt;%
  filter(Crop == &#39;Potatoes (tonnes per hectare)&#39;) %&gt;%
  group_by(Entity, Code) %&gt;%
  summarize(average_yield = sum(Value, na.rm = TRUE) / 
              (max(crop_yields_long$Year) - min(crop_yields_long$Year))) %&gt;%
  arrange(desc(average_yield)) %&gt;%
  ungroup() %&gt;%
  filter(is.na(Code) == FALSE) %&gt;%
  slice(1:20)</code></pre>
<pre class="r"><code>avg_yield_bananas20 &lt;- crop_yields_long %&gt;%
  filter(Crop == &#39;Bananas (tonnes per hectare)&#39;) %&gt;%
  group_by(Entity, Code) %&gt;%
  summarize(average_yield = sum(Value, na.rm = TRUE) / 
              (max(crop_yields_long$Year) - min(crop_yields_long$Year))) %&gt;%
  arrange(desc(average_yield)) %&gt;%
  ungroup() %&gt;%
  filter(is.na(Code) == FALSE) %&gt;%
  slice(1:20)</code></pre>
<pre class="r"><code>avg_yield_both &lt;- crop_yields_long %&gt;%
  filter(Crop == &#39;Bananas (tonnes per hectare)&#39; | Crop == &#39;Potatoes (tonnes per hectare)&#39;) %&gt;%
  group_by(Entity, Code, Crop) %&gt;%
  summarize(average_yield = sum(Value, na.rm = TRUE) / 
              (max(crop_yields_long$Year) - min(crop_yields_long$Year))) %&gt;%
  filter(is.na(Code) == FALSE)

ggplot(avg_yield_both, aes(Crop, average_yield)) +
  geom_boxplot(outlier.shape = NA) +
  geom_jitter()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="672" />
In the above plot, each point represents a country (regions and subregions were removed from the data) and its average yield of each crop per year since 1961. The upper outliers for the data are significantly higher for bananas, which also has a first quartile of 0.</p>
<pre class="r"><code>avg_yield_bananas20</code></pre>
<pre><code>## # A tibble: 20 x 3
##    Entity        Code  average_yield
##    &lt;chr&gt;         &lt;chr&gt;         &lt;dbl&gt;
##  1 Mali          MLI            56.9
##  2 Nicaragua     NIC            50.0
##  3 Panama        PAN            45.2
##  4 Costa Rica    CRI            42.7
##  5 Honduras      HND            39.3
##  6 Spain         ESP            39.1
##  7 Israel        ISR            38.6
##  8 Colombia      COL            31.9
##  9 Guatemala     GTM            31.1
## 10 Egypt         EGY            31.1
## 11 Indonesia     IDN            31.0
## 12 Cote d&#39;Ivoire CIV            28.1
## 13 Turkey        TUR            27.6
## 14 Martinique    MTQ            26.4
## 15 Ecuador       ECU            25.9
## 16 Cape Verde    CPV            25.8
## 17 Suriname      SUR            25.5
## 18 Portugal      PRT            25.4
## 19 Cyprus        CYP            24.5
## 20 Argentina     ARG            24.2</code></pre>
<pre class="r"><code>avg_yield_potatoes20</code></pre>
<pre><code>## # A tibble: 20 x 3
##    Entity         Code  average_yield
##    &lt;chr&gt;          &lt;chr&gt;         &lt;dbl&gt;
##  1 Netherlands    NLD            40.2
##  2 Switzerland    CHE            37.0
##  3 New Zealand    NZL            36.5
##  4 United Kingdom GBR            35.6
##  5 United States  USA            35.6
##  6 Denmark        DNK            33.6
##  7 France         FRA            33.0
##  8 Israel         ISR            32.8
##  9 Germany        DEU            31.8
## 10 Sweden         SWE            29.4
## 11 Ireland        IRL            28.9
## 12 Japan          JPN            28.1
## 13 Australia      AUS            27.9
## 14 Austria        AUT            27.3
## 15 Norway         NOR            25.0
## 16 Kuwait         KWT            23.6
## 17 South Africa   ZAF            22.5
## 18 Turkey         TUR            21.6
## 19 Canada         CAN            21.6
## 20 Argentina      ARG            21.3</code></pre>
<pre class="r"><code>change_in_land_efficiency_since_1961 &lt;- dat[[1]] %&gt;%
  rename(Land_Efficiency = 
           `Arable land needed to produce a fixed quantity of crops ((1.0 = 1961))`) %&gt;%
  filter(Year == max(Year))

change_in_land_top20 &lt;- change_in_land_efficiency_since_1961 %&gt;%
  arrange(Land_Efficiency) %&gt;%
  filter(Entity != &#39;Eastern Asia&#39;) %&gt;%
  slice(1:20)
  
change_in_land_top20$Entity &lt;- factor(change_in_land_top20$Entity,
                               levels = change_in_land_top20$Entity[order(
                                   change_in_land_top20$Land_Efficiency, decreasing = TRUE)])

ggplot(change_in_land_top20, aes(x = Entity, y = Land_Efficiency)) +
  geom_col() +
  coord_flip()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>tractors_numeric &lt;- dat[[3]] %&gt;%
  filter(str_detect(dat[[3]]$Year, &#39;[:alpha:]&#39;) == FALSE) %&gt;%
  mutate(Year = as.numeric(Year)) %&gt;%
  filter(is.na(`Cereal yield (kilograms per hectare) (kg per hectare)`) == FALSE,
         is.na(`Tractors per 100 sq km arable land`) == FALSE,
         !(Code %in% c(&#39;ARE&#39;, &#39;VCT&#39;)))
  
ggplot(tractors_numeric, aes(x =`Tractors per 100 sq km arable land`,
                             y = `Cereal yield (kilograms per hectare) (kg per hectare)`)) +
  geom_point() +
  geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>tractors_numeric %&gt;%
  arrange(desc(`Cereal yield (kilograms per hectare) (kg per hectare)`))</code></pre>
<pre><code>## # A tibble: 6,835 x 6
##    Entity  Code   Year `Tractors per 100… `Cereal yield (kilo… `Total populatio…
##    &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;              &lt;dbl&gt;                &lt;dbl&gt;             &lt;dbl&gt;
##  1 Puerto… PRI    1983               486.                9789.           3202000
##  2 Puerto… PRI    1981               523.                9695.           3132000
##  3 Puerto… PRI    1982               511.                9672.           3168000
##  4 Belgium BEL    2004              1137.                9185.          10480000
##  5 Kuwait  KWT    1994               160                 9148.           1659000
##  6 Belgium BEL    2005              1127.                8650.          10547000
##  7 Belgium BEL    2003              1150.                8531.          10419000
##  8 Belgium BEL    2002              1154.                8501.          10365000
##  9 Nether… NLD    1996              1866.                8293.          15563000
## 10 Belgium BEL    2001              1136.                8218.          10319000
## # … with 6,825 more rows</code></pre>
<pre class="r"><code>fertilizer_use &lt;- dat[[2]] %&gt;%
  filter(is.na(`Cereal yield (tonnes per hectare)`) == FALSE
         )

ggplot(dat[[2]], aes(x = `Nitrogen fertilizer use (kilograms per hectare)`,
                             y = `Cereal yield (tonnes per hectare)`)) +
  geom_point() +
  geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 9127 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 9127 rows containing missing values (geom_point).</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
